<!DOCTYPE html>
<html lang="he" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>שירות תמלול קבצי אודיו | המרת קול לטקסט מדויק</title>
    <meta name="description" content="המר קבצי אודיו לטקסט בעברית בקלות. שירות תמלול אודיו מהיר ומדויק.">

    <!-- קבצי CSS המפוצלים במקום קובץ components.css -->
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/buttons.css">
    <link rel="stylesheet" href="css/forms.css">
    <link rel="stylesheet" href="css/api-settings.css">
    <link rel="stylesheet" href="css/upload.css">
    <link rel="stylesheet" href="css/progress.css">
    <link rel="stylesheet" href="css/tabs-nav.css">
    <link rel="stylesheet" href="css/results.css">
    <link rel="stylesheet" href="css/modals.css">
    <link rel="stylesheet" href="css/badges.css">
    <link rel="stylesheet" href="css/utilities.css">

    <link
        href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700&family=Rubik:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="icon" type="image/png" href="icon.png" />

    <script src="https://cdn.jsdelivr.net/npm/lamejs@1.2.0/lame.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

</head>

<body>
    <div class="container">
        <header>
            <h1>תמלול קבצי אודיו 🎙️</h1>
            <p class="subtitle">העלה קובץ אודיו מכל סוג ותוך רגעים בודדים תקבל תמלול מדויק בעברית או בשפות נוספות</p>
        </header>

        <div class="card">
            <!-- תמלולים אחרונים וכפתור הגדרות - שורה עליונה מסודרת -->
            <div class="top-controls-bar">
                <button id="api-settings-btn" class="control-btn settings-btn">
                    <i class="fas fa-cog"></i>
                    <div class="api-button-content">
                        <span>הגדרות API</span>
                        <div id="provider-indicator" class="provider-indicator">
                            <span id="provider-icon">🤖</span>
                            <span id="provider-name">OpenAI</span>
                        </div>
                    </div>
                </button>
                <button id="view-recent-transcriptions-btn" class="control-btn recent-btn">
                    <i class="fas fa-history"></i>
                    <span>תמלולים אחרונים</span>
                    <span id="recent-count" class="count-badge" style="display: none;"></span>
                </button>
            </div>


            <!-- לשוניות אפשרויות העלאה -->
            <div class="upload-tabs">
                <div class="tabs-header">
                    <button class="tab-btn active" data-tab="upload-file">
                        <i class="fas fa-file-audio"></i> העלאת קובץ
                    </button>
                    <button class="tab-btn" data-tab="youtube-link">
                        <i class="fab fa-youtube"></i> סרטון יוטיוב
                    </button>
                    <button class="tab-btn" data-tab="record-audio">
                        <i class="fas fa-microphone"></i> הקלטה ישירה
                    </button>
                </div>

                <div class="tabs-content">
                    <!-- תוכן לשונית העלאת קובץ -->
                    <div class="tab-content active" id="upload-file-content">
                        <div id="upload-container">
                            <div id="upload-area" class="upload-area">
                                <div class="upload-icon">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                </div>
                                <h3>גרור לכאן קובץ אודיו</h3>
                                <p>או לחץ כדי לבחור קובץ (MP3, WAV, M4A, OGG ועוד)</p>
                                <input type="file" id="file-input" accept="audio/*,.mp3,.wav,.webm,.ogg,.m4a"
                                    style="display: none;">
                                <button class="btn" id="select-file-btn"><i class="fas fa-file-audio"></i> בחר קובץ
                                    אודיו</button>
                            </div>

                            <div id="file-info" class="file-info">
                                <p><i class="fas fa-file-audio"></i> הקובץ שנבחר: <span id="file-name"
                                        class="file-name"></span></p>
                                <p id="file-size"></p>

                                <div id="estimated-time-container" class="estimated-time-box">
                                    <i class="fas fa-clock"></i>
                                    <span class="estimated-label">זמן ועלות משוערים לתמלול:</span>
                                    <span id="time-estimate">—</span>
                                </div>

                                <div class="button-group">
                                    <button class="btn" id="transcribe-btn"><i class="fas fa-magic"></i> התחל
                                        תמלול</button>
                                    <a href="#" id="download-source-btn" class="btn download-btn">
                                        <i class="fas fa-download"></i> הורד את קובץ האודיו
                                    </a>
                                </div>
                            </div>

                            <div id="progress-container" class="progress-container">
                                <h4 id="progress-status">מעבד את קובץ האודיו...</h4>
                                <div id="progress-bar-container" class="progress-bar-container">
                                    <div id="progress-bar" class="progress-bar"></div>
                                </div>
                                <p id="progress-text" class="progress-text">0%</p>
                                <div class="loading-spinner"></div>
                                <p class="note">תהליך התמלול עשוי להימשך מספר דקות בהתאם לאורך הקובץ</p>
                            </div>

                            <div id="loading-spinner" class="loading-spinner"></div>
                            <div id="error-message" class="error-message"></div>
                        </div>
                    </div>

                    <!-- תוכן לשונית יוטיוב -->
                    <div class="tab-content" id="youtube-link-content">
                        <div class="youtube-input-area">
                            <h3>הזן קישור לסרטון יוטיוב</h3>
                            <p>המערכת תמללה את השמע מהסרטון</p>

                            <div class="youtube-input-group">
                                <input type="text" id="youtube-url" placeholder="הדבק כאן קישור YouTube" />
                                <button class="btn" id="process-youtube-btn">
                                    <i class="fas fa-magic"></i> תמלל סרטון
                                </button>
                            </div>

                            <div class="youtube-info" style="display: none;"></div>

                            <div id="youtube-loading" style="display: none; margin-top: 1rem; text-align: center;">
                                <i class="fas fa-spinner fa-spin"
                                    style="font-size: 18px; color: #007bff; margin-left: 6px;"></i>
                                <span style="font-size: 15px; color: #333;">התהליך עשוי להימשך מספר רגעים...</span>
                            </div>

                            <p class="note"><i class="fas fa-info-circle"></i> הערה: יש להשתמש בקישור ישיר לסרטון
                                YouTube</p>
                        </div>
                    </div>

                    <!-- תוכן לשונית הקלטה ישירה -->
                    <div class="tab-content" id="record-audio-content">
                        <div class="record-area">
                            <h3>הקלט אודיו ישירות</h3>
                            <p>לחץ על הכפתור כדי להתחיל בהקלטה</p>
                            <div class="record-buttons">
                                <button class="btn btn-record" id="start-record-btn">
                                    <i class="fas fa-microphone"></i> התחל הקלטה
                                </button>
                                <button class="btn btn-stop" id="stop-record-btn" disabled>
                                    <i class="fas fa-stop-circle"></i> עצור הקלטה
                                </button>
                            </div>
                            <div class="record-status">
                                <div id="record-timer">00:00</div>
                                <div id="record-wave" class="record-wave">
                                    <canvas id="waveform" width="800" height="200" class="record-wave-canvas"></canvas>
                                </div>
                            </div>
                            <p class="note"><i class="fas fa-info-circle"></i> לאחר סיום ההקלטה תוכל לתמלל את האודיו</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- אזור התוצאות המעודכן עם טאבים -->
            <div id="result-container" class="result-container">
                <h3 class="decorated">תוצאת התמלול <span class="badge badge-success">הושלם!</span></h3>

                <!-- לשוניות תוצאה עם הגהה וסיכום AI -->
                <div class="result-tabs">
                    <button class="result-tab-btn active" data-result-tab="original">
                        <i class="fas fa-file-text"></i> תמלול מקורי
                    </button>
                    <button class="result-tab-btn" data-result-tab="enhanced">
                        <i class="fas fa-magic"></i> הגהה חכמה
                    </button>
                    <button class="result-tab-btn" data-result-tab="summary">
                        <i class="fas fa-brain"></i> סיכום AI
                    </button>
                </div>

                <!-- תוכן לשוניות התוצאה -->
                <div class="result-tabs-content">
                    <!-- תמלול מקורי -->
                    <div class="result-tab-content active" id="original-content">
                        <textarea id="transcription-result" readonly></textarea>
                    </div>

                    <!-- הגהה חכמה -->
                    <div class="result-tab-content" id="enhanced-content">
                        <div class="enhancement-controls">
                            <!-- בחירת ספק AI להגהה -->
                            <div class="provider-select">
                                <label for="enhance-provider-select">ספק AI להגהה:</label>
                                <select id="enhance-provider-select">
                                    <option value="openai">OpenAI GPT</option>
                                    <option value="groq" selected>Groq Llama</option>
                                    <option value="gemini">Google Gemini</option>
                                    <option value="anthropic">Anthropic Claude</option>
                                </select>
                            </div>

                            <!-- שדה API Key דינמי להגהה -->
                            <div id="enhance-api-input" class="api-input-section" style="display: none;">
                                <label id="enhance-api-label">מפתח API:</label>
                                <div class="api-input-group">
                                    <input type="password" id="enhance-api-key" placeholder="הזן מפתח API">
                                    <button id="save-enhance-api" class="btn btn-sm">
                                        <i class="fas fa-save"></i> שמור
                                    </button>
                                </div>
                                <div id="enhance-api-status" class="api-status-mini"></div>
                            </div>

                            <!-- אפשרויות הגהה -->
                            <div class="summary-length-options">
                                <label for="enhance-mode">בחר סוג הגהה:</label>
                                <select id="enhance-mode">
                                    <option value="default" selected>הגהת ברירת מחדל</option>
                                    <option value="custom">פרומפט חופשי</option>
                                </select>

                                <button id="generate-enhancement-btn" class="btn btn-primary">
                                    <i class="fas fa-pen-to-square"></i> בצע הגהה
                                </button>
                            </div>

                            <!-- פרומפט מותאם אישית להגהה -->
                            <div id="enhance-custom-prompt-container" class="custom-prompt-container"
                                style="display: none;">
                                <textarea id="enhance-custom-prompt"
                                    placeholder="כתוב כאן הוראות מותאמות אישית להגהה..." rows="3"></textarea>
                            </div>
                        </div>

                        <div id="enhanced-result"
                            style="min-height: 300px; padding: 15px; border: 1px solid #ced4da; border-radius: 8px; background: white; overflow-y: auto;">
                            <div class="processing-message">
                                <i class="fas fa-magic"></i>
                                לחץ על "בצע הגהה" כדי לשפר את הטקסט באמצעות AI
                            </div>
                        </div>
                    </div>

                    <!-- סיכום AI -->
                    <div class="result-tab-content" id="summary-content">
                        <div class="summary-controls">
                            <!-- בחירת ספק AI לסיכום -->
                            <div class="provider-select">
                                <label for="summary-provider-select">ספק AI לסיכום:</label>
                                <select id="summary-provider-select">
                                    <option value="openai">OpenAI GPT</option>
                                    <option value="groq" selected>Groq Llama</option>
                                    <option value="gemini">Google Gemini</option>
                                    <option value="anthropic">Anthropic Claude</option>
                                </select>
                            </div>

                            <!-- שדה API Key דינמי לסיכום -->
                            <div id="summary-api-input" class="api-input-section" style="display: none;">
                                <label id="summary-api-label">מפתח API:</label>
                                <div class="api-input-group">
                                    <input type="password" id="summary-api-key" placeholder="הזן מפתח API">
                                    <button id="save-summary-api" class="btn btn-sm">
                                        <i class="fas fa-save"></i> שמור
                                    </button>
                                </div>
                                <div id="summary-api-status" class="api-status-mini"></div>
                            </div>

                            <!-- אפשרויות סיכום -->
                            <div class="summary-length-options">
                                <label for="summary-length">בחר אורך סיכום:</label>
                                <select id="summary-length">
                                    <option value="short">קצר</option>
                                    <option value="medium" selected>בינוני</option>
                                    <option value="long">ארוך</option>
                                    <option value="custom">פרומפט חופשי</option>
                                </select>

                                <button id="generate-summary-btn" class="btn btn-primary">
                                    <i class="fas fa-brain"></i> צור סיכום
                                </button>
                            </div>

                            <!-- פרומפט מותאם אישית לסיכום -->
                            <div id="custom-prompt-container" class="custom-prompt-container" style="display: none;">
                                <textarea id="custom-prompt" placeholder="הקלד הוראות מותאמות אישית לסיכום..."
                                    rows="3"></textarea>
                            </div>
                        </div>

                        <div id="summary-result"
                            style="min-height: 300px; padding: 15px; border: 1px solid #ced4da; border-radius: 8px; background: white; overflow-y: auto;">
                            <div class="processing-message">
                                <i class="fas fa-brain"></i>
                                לחץ על "צור סיכום" כדי לקבל סיכום חכם של הטקסט
                            </div>
                        </div>
                    </div>
                </div>

                <!-- כפתורי פעולה -->
                <div class="actions">
                    <div class="action-group">
                        <button class="btn new-btn" id="new-btn"><i class="fas fa-plus"></i> תמלול חדש</button>
                    </div>

                    <div class="action-group">
                        <button class="btn copy-btn small-btn" id="copy-btn"><i class="fas fa-copy"></i> העתק</button>

                        <div class="dropdown">
                            <button class="btn download-btn dropdown-toggle" id="download-dropdown-btn">
                                <i class="fas fa-download"></i> הורד כ-
                            </button>
                            <div class="dropdown-menu" id="download-options">
                                <button class="dropdown-item" data-format="txt"><i class="fas fa-file-alt"></i> קובץ
                                    טקסט (TXT)</button>
                                <button class="dropdown-item" data-format="srt"><i class="fas fa-closed-captioning"></i>
                                    כתוביות (SRT)</button>
                                <button class="dropdown-item" data-format="word"><i class="fas fa-file-word"></i> מסמך
                                    Word</button>
                                <button class="dropdown-item" data-format="pdf"><i class="fas fa-file-pdf"></i> קובץ
                                    PDF</button>
                                <button class="dropdown-item" data-format="mp3"><i class="fas fa-music"></i> אודיו
                                    MP3</button>
                                <button class="dropdown-item" data-format="wav"><i class="fas fa-volume-up"></i> אודיו
                                    WAV</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="floating-card" style="display: none;" id="tips-card">
                <h4><i class="fas fa-lightbulb"></i> טיפים לתמלול מוצלח</h4>
                <ul>
                    <li>וודא שהקובץ באיכות טובה עם רעש רקע מינימלי</li>
                    <li>עבור קבצים ארוכים, המערכת מחלקת אוטומטית לקטעים לשיפור איכות התמלול</li>
                    <li>מומלץ לבדוק את התמלול ולתקן שגיאות במידת הצורך</li>
                    <li>השתמש בהגהה החכמה לשיפור הטקסט</li>
                    <li>צור סיכום AI לקבלת הנקודות העיקריות</li>
                </ul>
            </div>
        </div>

        <!-- Popup של תמלולים אחרונים -->
        <div id="recent-transcriptions-popup" class="transcriptions-popup-overlay">
            <div class="transcriptions-popup">
                <div class="popup-header">
                    <h3><i class="fas fa-history"></i> תמלולים אחרונים</h3>
                    <button id="close-transcriptions-popup" class="close-popup-btn">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <div class="popup-content">
                    <div id="recent-transcriptions-list" class="transcriptions-list">
                        <!-- תמלולים יתווספו כאן דינמית -->
                    </div>

                    <div class="popup-actions">
                        <button id="clear-all-transcriptions" class="btn btn-danger">
                            <i class="fas fa-trash-alt"></i> מחק הכל
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Popup הגדרות API -->
        <div id="api-settings-popup" class="settings-popup-overlay">
            <div class="settings-popup">
                <div class="popup-header">
                    <h3><i class="fas fa-cog"></i> הגדרות API</h3>
                    <button id="close-settings-popup" class="close-popup-btn">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <div class="popup-content">
                    <div class="api-section" style="margin-bottom: 2rem;">
                        <h4>מצב תמלול:</h4>
                        <label for="transcription-mode">בחר כיצד יבוצע התמלול:</label>
                        <span class="tooltip-icon">
                            <i class="fas fa-info-circle"></i>
                            <span class="tooltip-text">
                                <strong>OpenAI Whisper:</strong> תמלול מדויק באיכות גבוהה<br>
                                <strong>Hugging Face:</strong> תמלול חינמי בסיסי<br>
                                <strong>Groq:</strong> תמלול מהיר עם Whisper<br>
                                <strong>Google Gemini:</strong> תמלול וניתוח חכם<br>
                                <strong>Anthropic Claude:</strong> תמלול עם הבנה מתקדמת
                            </span>
                        </span>
                        <select id="transcription-mode" class="styled-select">
                            <option value="openai" selected>OpenAI Whisper – תמלול מדויק</option>
                            <option value="ivrit">Ivrit.ai – תמלול עברית מתקדם</option>
                            <option value="groq">Groq – תמלול מהיר</option>
                            <option value="gemini">Google Gemini – תמלול חכם</option>
                            <option value="claude">Anthropic Claude – תמלול מתקדם</option>
                        </select>

                        <div class="provider-capabilities"
                            style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; font-size: 14px;">
                            <div class="capability-legend">
                                <h5 style="margin: 0 0 12px 0; color: #495057; font-size: 15px;">יכולות כל ספק:</h5>
                                <div class="capability-item">
                                    <div class="capability-header">🎙️ <strong>תמלול אודיו:</strong></div>
                                    <div class="capability-list">OpenAI, Ivrit.ai</div>
                                </div>
                                <div class="capability-item">
                                    <div class="capability-header">✏️ <strong>הגהה וסיכום:</strong></div>
                                    <div class="capability-list">OpenAI, Groq, Gemini, Claude</div>
                                </div>
                                <div class="capability-item">
                                    <div class="capability-header">🇮🇱 <strong>עברית מותאמת:</strong></div>
                                    <div class="capability-list">Ivrit.ai (מיוחד לעברית)</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- חלק חובה - OpenAI -->
                    <div class="api-section required">
                        <h4>OpenAI Whisper – תמלול מדויק בעזרת AI מתקדם <span class="recommended-badge">מומלץ</span>
                        </h4>
                        <label for="openai-api-key">מפתח API של OpenAI</label>
                        <p class="api-description">נדרש לתמלול באיכות גבוהה עם Whisper API. ניתן לקבל מפתח באתר <a
                                href="https://platform.openai.com" target="_blank">platform.openai.com</a></p>
                        <div class="api-input-group">
                            <input type="password" id="openai-api-key" placeholder="הדבק את מפתח ה-API של OpenAI כאן">
                            <button id="save-openai-key" class="btn"><i class="fas fa-save"></i> שמור</button>
                        </div>
                        <div style="margin-top: 10px;">
                            <input type="checkbox" id="show-openai-key" style="margin-left: 8px;">
                            <label for="show-openai-key">הצג/הסתר מפתח API</label>
                        </div>
                        <div id="openai-key-status" class="api-key-status"></div>
                        <div class="api-help-icon" id="openai-help-icon">
                            <i class="fas fa-question-circle"></i>
                        </div>
                    </div>

                    <!-- Toggle לאפשרויות נוספות -->
                    <div class="additional-options-toggle">
                        <button id="toggle-additional-options" class="toggle-additional-btn">
                            <i class="fas fa-plus"></i>
                            <span>הצג אפשרויות נוספות (אופציונלי)</span>
                            <i class="fas fa-chevron-down toggle-arrow"></i>
                        </button>

                    </div>

                    <!-- אפשרויות נוספות - מוסתרות בברירת מחדל -->
                    <div id="additional-options" class="additional-options" style="display: none;">
                        <!-- Ivrit.ai -->
                        <div class="api-section optional">
                            <h4>Ivrit.ai – תמלול עברית מתקדם <span class="optional-badge">אופציונלי</span></h4>
                            <label for="ivrit-api-key">מפתח RunPod API</label>
                            <p class="api-description">עבור תמלול מותאם לעברית עם Ivrit.ai דרך RunPod. נדרש מפתח RunPod
                                API ו-Endpoint ID. ניתן לקבל מפתח באתר <a href="https://runpod.io"
                                    target="_blank">runpod.io</a></p>

                            <div class="api-input-group">
                                <input type="password" id="ivrit-api-key" placeholder="הדבק את מפתח ה-RunPod API כאן">
                                <button id="save-ivrit-key" class="btn"><i class="fas fa-save"></i> שמור</button>
                            </div>

                            <div class="api-input-group" style="margin-top: 10px;">
                                <input type="text" id="ivrit-endpoint-id" placeholder="הזן את ה-Endpoint ID מ-RunPod">
                                <button id="save-ivrit-endpoint" class="btn"><i class="fas fa-save"></i> שמור
                                    Endpoint</button>
                            </div>

                            <div style="margin-top: 10px;">
                                <input type="checkbox" id="show-ivrit-key" style="margin-left: 8px;">
                                <label for="show-ivrit-key">הצג/הסתר מפתח API</label>
                            </div>
                            <div id="ivrit-key-status" class="api-key-status"></div>
                            <div class="api-help-icon" id="ivrit-help-icon">
                                <i class="fas fa-question-circle"></i>
                            </div>
                        </div>

                        <!-- Groq -->
                        <div class="api-section optional">
                            <h4>Groq – תמלול והגהה מהירים <span class="optional-badge">אופציונלי</span></h4>
                            <label for="groq-api-key">מפתח API של Groq</label>
                            <p class="api-description">לתמלול מהיר עם Whisper ויכולות הגהה וסיכום חכמה מבוססי AI. ניתן
                                לקבל מפתח באתר <a href="https://groq.com" target="_blank">groq.com</a></p>
                            <div class="api-input-group">
                                <input type="password" id="groq-api-key" placeholder="הדבק את מפתח ה-API של Groq כאן">
                                <button id="save-groq-key" class="btn"><i class="fas fa-save"></i> שמור</button>
                            </div>
                            <div style="margin-top: 10px;">
                                <input type="checkbox" id="show-groq-key" style="margin-left: 8px;">
                                <label for="show-groq-key">הצג/הסתר מפתח API</label>
                            </div>
                            <div id="groq-key-status" class="api-key-status"></div>
                            <div class="api-help-icon" id="groq-help-icon">
                                <i class="fas fa-question-circle"></i>
                            </div>
                        </div>

                        <!-- Gemini -->
                        <div class="api-section optional">
                            <h4>Google Gemini – תמלול ועיבוד חכם <span class="optional-badge">אופציונלי</span></h4>
                            <label for="gemini-api-key">מפתח API של Google Gemini</label>
                            <p class="api-description">עבור תמלול מתקדם עם יכולות ניתוח, הגהה וסיכום. ניתן לקבל מפתח
                                באתר <a href="https://ai.google.dev/" target="_blank">ai.google.dev</a></p>
                            <div class="api-input-group">
                                <input type="password" id="gemini-api-key"
                                    placeholder="הדבק את מפתח ה-API של Gemini כאן">
                                <button id="save-gemini-key" class="btn"><i class="fas fa-save"></i> שמור</button>
                            </div>
                            <div style="margin-top: 10px;">
                                <input type="checkbox" id="show-gemini-key" style="margin-left: 8px;">
                                <label for="show-gemini-key">הצג/הסתר מפתח API</label>
                            </div>
                            <div id="gemini-key-status" class="api-key-status"></div>
                            <div class="api-help-icon" id="gemini-help-icon">
                                <i class="fas fa-question-circle"></i>
                            </div>
                        </div>

                        <!-- Anthropic -->
                        <div class="api-section optional">
                            <h4>Anthropic Claude – הגהה וסיכום מתקדמים <span class="optional-badge">אופציונלי</span>
                            </h4>
                            <label for="anthropic-api-key">מפתח API של Anthropic</label>
                            <p class="api-description">עבור הגהה וסיכום באיכות גבוהה עם Claude. לא תומך בתמלול ישיר.
                                ניתן לקבל מפתח באתר <a href="https://console.anthropic.com"
                                    target="_blank">console.anthropic.com</a></p>
                            <div class="api-input-group">
                                <input type="password" id="anthropic-api-key"
                                    placeholder="הדבק את מפתח ה-API של Anthropic כאן">
                                <button id="save-anthropic-key" class="btn"><i class="fas fa-save"></i> שמור</button>
                            </div>
                            <div style="margin-top: 10px;">
                                <input type="checkbox" id="show-anthropic-key" style="margin-left: 8px;">
                                <label for="show-anthropic-key">הצג/הסתר מפתח API</label>
                            </div>
                            <div id="anthropic-key-status" class="api-key-status"></div>
                            <div class="api-help-icon" id="anthropic-help-icon">
                                <i class="fas fa-question-circle"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- הודעת אישור עלות -->
        <div id="cost-confirmation-popup" class="cost-popup-overlay">
            <div class="cost-popup">
                <div class="popup-header">
                    <h3><i class="fas fa-dollar-sign"></i> אישור עלות תמלול</h3>
                </div>

                <div class="popup-content">
                    <div class="cost-details">
                        <div class="file-info-cost">
                            <p><strong>שם הקובץ:</strong> <span id="cost-file-name"></span></p>
                            <p><strong>גודל הקובץ:</strong> <span id="cost-file-size"></span></p>
                        </div>

                        <div class="cost-breakdown">
                            <p><strong>זמן משוער לתמלול:</strong> <span id="cost-estimated-time"></span></p>
                            <p><strong>עלות משוערת:</strong></p>
                            <div class="cost-amounts">
                                <div class="cost-usd">$<span id="cost-usd">0.00</span></div>
                                <div class="cost-ils">(<span id="cost-ils">0.00</span> ₪)</div>
                            </div>
                        </div>
                    </div>

                    <div class="popup-actions">
                        <button id="confirm-transcription" class="btn btn-confirm">
                            <i class="fas fa-check"></i> אישור והמשך בתמלול
                        </button>
                        <button id="cancel-transcription" class="btn btn-cancel">
                            <i class="fas fa-times"></i> ביטול
                        </button>
                    </div>

                    <div class="dont-show-again">
                        <input type="checkbox" id="dont-show-cost-again">
                        <label for="dont-show-cost-again">אל תציג הודעה זו שוב</label>
                    </div>
                </div>
            </div>
        </div>

        <!-- מודלים להדרכה -->

        <!-- מודל OpenAI -->
        <div id="openai-guide-modal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h3>איך להשיג מפתח API של OpenAI</h3>
                <div class="guide-steps">
                    <div class="step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4>היכנס לאתר OpenAI</h4>
                            <p>פתח את האתר <a href="https://platform.openai.com/"
                                    target="_blank">platform.openai.com</a></p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4>צור חשבון או התחבר</h4>
                            <p>לחץ על "Sign Up" בפינה הימנית העליונה ליצירת חשבון חדש, או התחבר לחשבון קיים</p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4>נווט לאזור API Keys</h4>
                            <p>לאחר ההתחברות, לחץ על "API Keys" בתפריט הצדדי השמאלי</p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h4>צור מפתח API חדש</h4>
                            <p>לחץ על כפתור "Create new secret key", תן שם למפתח ולחץ על "Create secret key"</p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">5</div>
                        <div class="step-content">
                            <h4>העתק את המפתח</h4>
                            <p>העתק את המפתח שנוצר והדבק אותו בשדה "מפתח API של OpenAI" בעמוד זה</p>
                        </div>
                    </div>
                </div>
                <div class="guide-note">
                    <p><strong>שים לב:</strong> מפתח ה-API נשמר רק על המכשיר שלך באופן מקומי ואינו נשלח לשום שרת אחר
                        מלבד OpenAI.</p>
                </div>
            </div>
        </div>

        <!-- הוסף את זה לפני סגירת body בindex.html, אחרי המודלים הקיימים -->

        <!-- מודל Ivrit.ai מעודכן -->
        <div id="ivrit-guide-modal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h3>🇮🇱 איך להגדיר Ivrit.ai עם RunPod</h3>

                <div class="guide-intro">
                    <p><strong>Ivrit.ai</strong> הוא מודל תמלול מתקדם המותאם במיוחד לעברית, הפועל דרך פלטפורמת RunPod.
                    </p>
                </div>

                <div class="guide-steps">
                    <div class="step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4>🔗 הירשם ל-RunPod</h4>
                            <p>פתח את האתר <a href="https://runpod.io" target="_blank">runpod.io</a> ולחץ על "Sign Up"
                            </p>
                            <p>השלם את תהליך הרישום והכנס לחשבון שלך</p>
                        </div>
                    </div>

                    <div class="step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4>🔑 יצירת מפתח API</h4>
                            <p>בדף הראשי של RunPod:</p>
                            <ul>
                                <li>לחץ על הפרופיל שלך (פינה ימנית עליונה)</li>
                                <li>בחר "Settings" מהתפריט</li>
                                <li>עבור לטאב "API Keys"</li>
                                <li>לחץ "Create API Key"</li>
                                <li>תן שם למפתח (למשל: "Ivrit-ai-key")</li>
                                <li>העתק את המפתח ושמור אותו במקום בטוח</li>
                            </ul>
                        </div>
                    </div>

                    <div class="step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4>🚀 פריסת Ivrit.ai Endpoint</h4>
                            <p>חזור לדף הראשי ובצע את השלבים הבאים:</p>
                            <ul>
                                <li>לחץ על "Serverless" בתפריט הצדדי</li>
                                <li>לחץ "Browse Public Models"</li>
                                <li>חפש "ivrit" או "ivrit-ai" בשדה החיפוש</li>
                                <li>מצא את המודל "ivrit-ai/whisper-large-v3-turbo-ct2"</li>
                                <li>לחץ "Deploy" ליד המודל</li>
                            </ul>
                        </div>
                    </div>

                    <div class="step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h4>⚙️ הגדרת Endpoint</h4>
                            <p>בעמוד ההגדרה:</p>
                            <ul>
                                <li>תן שם ל-Endpoint (למשל: "my-ivrit-ai")</li>
                                <li>בחר GPU מתאים (V100 או A100 מומלצים)</li>
                                <li>השאר את שאר ההגדרות כברירת מחדל</li>
                                <li>לחץ "Deploy"</li>
                                <li>חכה שהסטטוס יהפוך ל-"Running" (כמה דקות)</li>
                            </ul>
                        </div>
                    </div>

                    <div class="step">
                        <div class="step-number">5</div>
                        <div class="step-content">
                            <h4>📋 העתקת Endpoint ID</h4>
                            <p>לאחר שה-Endpoint פעיל:</p>
                            <ul>
                                <li>בעמוד הEndpoints שלך, תראה את הEndpoint החדש</li>
                                <li>העתק את ה-"Endpoint ID" (מחרוזת של אותיות ומספרים)</li>
                                <li>זה נראה בערך כך: <code>abc123def456</code></li>
                            </ul>
                        </div>
                    </div>

                    <div class="step">
                        <div class="step-number">6</div>
                        <div class="step-content">
                            <h4>✅ הזנת הפרטים באתר</h4>
                            <p>חזור לאתר התמלול:</p>
                            <ul>
                                <li>הדבק את <strong>מפתח ה-API</strong> בשדה הראשון</li>
                                <li>הדבק את <strong>Endpoint ID</strong> בשדה השני</li>
                                <li>לחץ "שמור" על שני השדות</li>
                                <li>וודא שמופיעה הודעה "נשמר בהצלחה"</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="guide-tips">
                    <h4>💡 טיפים חשובים:</h4>
                    <div class="tip-item">
                        <strong>💰 עלויות:</strong> RunPod גובה לפי זמן שימוש. זכור לכבות את ה-Endpoint כשלא משתמש
                    </div>
                    <div class="tip-item">
                        <strong>⚡ ביצועים:</strong> Ivrit.ai מותאם במיוחד לעברית ויתן תוצאות טובות יותר מOpenAI לטקסטים
                        בעברית
                    </div>
                    <div class="tip-item">
                        <strong>📏 גבלות:</strong> קבצים גדולים מ-10MB יחולקו אוטומטית לחלקים קטנים יותר
                    </div>
                    <div class="tip-item">
                        <strong>🔒 אבטחה:</strong> המפתחות נשמרים רק במכשיר שלך ולא נשלחים לשום מקום אחר
                    </div>
                </div>

                <div class="guide-links">
                    <h4>🔗 קישורים שימושיים:</h4>
                    <div class="links-grid">
                        <a href="https://runpod.io" target="_blank" class="guide-link">
                            <i class="fas fa-external-link-alt"></i> אתר RunPod
                        </a>
                        <a href="https://docs.runpod.io" target="_blank" class="guide-link">
                            <i class="fas fa-book"></i> תיעוד RunPod
                        </a>
                        <a href="https://github.com/ivrit-ai" target="_blank" class="guide-link">
                            <i class="fab fa-github"></i> Ivrit.ai GitHub
                        </a>
                    </div>
                </div>

                <div class="guide-note">
                    <p><strong>זקוק לעזרה?</strong> אם נתקלת בבעיות, נסה לרענן את הדף או לבדוק שהמפתחות הוזנו נכון.</p>
                </div>
            </div>
        </div>
        <!-- מודל Groq -->
        <div id="groq-guide-modal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h3>איך להשיג מפתח API של Groq</h3>
                <div class="guide-steps">
                    <div class="step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4>היכנס לאתר Groq</h4>
                            <p>פתח את האתר <a href="https://console.groq.com/" target="_blank">console.groq.com</a></p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4>צור חשבון או התחבר</h4>
                            <p>לחץ על "Sign Up" ליצירת חשבון חדש, או התחבר לחשבון קיים</p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4>נווט לאזור API Keys</h4>
                            <p>לאחר ההתחברות, נווט לאזור API Keys בממשק המשתמש</p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h4>צור מפתח API חדש</h4>
                            <p>לחץ על כפתור "Create API Key" ליצירת מפתח חדש</p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">5</div>
                        <div class="step-content">
                            <h4>העתק את המפתח</h4>
                            <p>העתק את המפתח שנוצר והדבק אותו בשדה "מפתח API של Groq" בעמוד זה</p>
                        </div>
                    </div>
                </div>
                <div class="guide-note">
                    <p><strong>שים לב:</strong> מפתח ה-API נשמר רק על המכשיר שלך באופן מקומי ואינו נשלח לשום שרת אחר
                        מלבד Groq.</p>
                </div>
            </div>
        </div>

        <!-- מודל Gemini -->
        <div id="gemini-guide-modal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h3>איך להשיג מפתח API של Google Gemini</h3>
                <div class="guide-steps">
                    <div class="step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4>היכנס לאתר Google AI Studio</h4>
                            <p>פתח את האתר <a href="https://ai.google.dev/" target="_blank">ai.google.dev</a></p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4>צור חשבון או התחבר</h4>
                            <p>התחבר עם חשבון Google שלך</p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4>נווט ל-API Keys</h4>
                            <p>לחץ על "Get API Key" בתפריט הראשי</p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h4>צור מפתח API חדש</h4>
                            <p>לחץ על "Create API Key" וצור מפתח חדש</p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">5</div>
                        <div class="step-content">
                            <h4>העתק את המפתח</h4>
                            <p>העתק את המפתח שנוצר והדבק אותו בשדה "מפתח API של Gemini" בעמוד זה</p>
                        </div>
                    </div>
                </div>
                <div class="guide-note">
                    <p><strong>שים לב:</strong> מפתח ה-API נשמר רק על המכשיר שלך באופן מקומי ואינו נשלח לשום שרת אחר
                        מלבד Google.</p>
                </div>
            </div>
        </div>

        <!-- מודל Anthropic -->
        <div id="anthropic-guide-modal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h3>איך להשיג מפתח API של Anthropic</h3>
                <div class="guide-steps">
                    <div class="step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4>היכנס לאתר Anthropic</h4>
                            <p>פתח את האתר <a href="https://console.anthropic.com/"
                                    target="_blank">console.anthropic.com</a></p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4>צור חשבון או התחבר</h4>
                            <p>לחץ על "Sign Up" ליצירת חשבון חדש, או התחבר לחשבון קיים</p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4>נווט לאזור API Keys</h4>
                            <p>לאחר ההתחברות, נווט לאזור API Keys בממשק המשתמש</p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h4>צור מפתח API חדש</h4>
                            <p>לחץ על כפתור "Create Key" ליצירת מפתח חדש</p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">5</div>
                        <div class="step-content">
                            <h4>העתק את המפתח</h4>
                            <p>העתק את המפתח שנוצר והדבק אותו בשדה "מפתח API של Anthropic" בעמוד זה</p>
                        </div>
                    </div>
                </div>
                <div class="guide-note">
                    <p><strong>שים לב:</strong> מפתח ה-API נשמר רק על המכשיר שלך באופן מקומי ואינו נשלח לשום שרת אחר
                        מלבד Anthropic.</p>
                </div>
            </div>
        </div>

        <!-- כפתור עזרה צף -->
        <button id="help-btn" title="עזרה"><i class="fas fa-question"></i></button>

        <!-- תיבת עזרה מעודכנת -->
        <div id="help-popup">
            <h2>מדריך שימוש מהיר</h2>

            <div class="help-step">
                <h3>
                    <span class="step-number">1</span>
                    הכנסת מפתח API ✔️
                </h3>
                <p>כדי שהתמלול יעבוד, עליך להזין מפתח API של OpenAI.</p>
                <div class="help-links">
                    <a href="https://platform.openai.com/api-keys" target="_blank">
                        <i class="fas fa-key"></i> קבל מפתח OpenAI
                    </a>
                </div>
                <button id="scroll-to-api" class="inline-btn">
                    <i class="fas fa-cog"></i> להסבר נרחב - עבור להגדרות API
                </button>
            </div>

            <div class="help-step">
                <h3>
                    <span class="step-number">2</span>
                    העלאת קובץ אודיו ✔️
                </h3>
                <p>העלה קובץ אודיו מכל סוג: MP3, WAV, M4A, OGG, WEBM ועוד פורמטים נתמכים.</p>
                <div class="help-links">
                    <a href="https://cloudconvert.com/audio-converter" target="_blank">
                        <i class="fas fa-exchange-alt"></i> המר קבצי אודיו אחרים
                    </a>
                </div>
            </div>

            <div class="help-step">
                <h3>
                    <span class="step-number">3</span>
                    התחלת תמלול ✔️
                </h3>
                <p>לחץ על "התחל תמלול" ותקבל טקסט מדויק תוך דקות ספורות.</p>
            </div>

            <div class="help-step">
                <h3>
                    <span class="step-number">4</span>
                    שיפור בעזרת AI ✨
                </h3>
                <p>השתמש בהגהה חכמה וסיכום AI לשיפור התוצאות ולקבלת תובנות.</p>
            </div>

            <div class="developer-toggle">
                <details>
                    <summary>על יוצר האתר <span class="profile-emoji">👨‍💻</span></summary>
                    <h4>ידידיה שאולי - מתכנת חובב</h4>
                    אני ידידיה שאולי, מפתח האתר הזה.

                    הקמתי אותו כדי להנגיש תמלול קולי איכותי במיוחד לדוברי עברית, בצורה פשוטה, חינמית וללא צורך בהרשמה.
                    עכשיו עם יכולות AI מתקדמות להגהה וסיכום!

                    אשמח לפידבק והצעות לשיפור!

                    <div class="developer-links">
                        <a href="https://github.com/yedi18" target="_blank">
                            <i class="fab fa-github"></i> GitHub
                        </a>
                        <a href="https://www.linkedin.com/in/yedidya-shauli-6084a928a/" target="_blank">
                            <i class="fab fa-linkedin"></i> LinkedIn
                        </a>
                    </div>
                </details>
            </div>

            <button id="close-help-popup" class="close-popup-btn">
                <i class="fas fa-times"></i>
            </button>
        </div>


        <footer>
            <p>© 2025 שירות תמלול אודיו - פשוט, מהיר ומדויק עם יכולות AI מתקדמות. <a href="#" id="show-tips">טיפים
                    לשימוש</a></p>
        </footer>

        <!-- טעינת קבצי JavaScript בסדר הנכון -->
        <script src="js/audioSplitter.js"></script>
        <script src="js/transcription.js"></script>
        <script src="js/enhancementHandler.js"></script>
        <script src="js/recordingHandler.js"></script>
        <script src="js/youtubeHandler.js"></script>
        <script src="js/transcriptionHistory.js"></script>

        <!-- מודולי ממשק משתמש -->
        <script src="js/js-ui/UICore.js"></script>
        <script src="js/js-ui/UIHandlers.js"></script>
        <script src="js/js-ui/UIFileOperations.js"></script>
        <script src="js/js-ui/UIAPIManagement.js"></script>
        <script src="js/js-ui/UIProgressDisplay.js"></script>
        <script src="js/js-ui/UIResultsDisplay.js"></script>
        <script src="js/js-ui/UI.js"></script>
        <script src="js/main.js"></script>

        <!-- סקריפטים לטיפול במודלים והתנהגות הממשק -->
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                // הוספת פונקציונליות להצגת טיפים
                document.getElementById('show-tips').addEventListener('click', function (e) {
                    e.preventDefault();
                    const tipsCard = document.getElementById('tips-card');
                    tipsCard.style.display = tipsCard.style.display === 'none' ? 'block' : 'none';
                });

                // טיפול ב-toggle של אפשרויות נוספות
                const toggleBtn = document.getElementById('toggle-additional-options');
                const additionalOptions = document.getElementById('additional-options');
                const toggleArrow = toggleBtn.querySelector('.toggle-arrow');

                if (toggleBtn && additionalOptions) {
                    toggleBtn.addEventListener('click', function () {
                        const isOpen = additionalOptions.style.display !== 'none';

                        if (isOpen) {
                            additionalOptions.style.display = 'none';
                            toggleBtn.querySelector('span').textContent = 'הצג אפשרויות נוספות (אופציונלי)';
                            toggleBtn.querySelector('.fas:first-child').className = 'fas fa-plus';
                            toggleArrow.style.transform = 'rotate(0deg)';
                        } else {
                            additionalOptions.style.display = 'block';
                            toggleBtn.querySelector('span').textContent = 'הסתר אפשרויות נוספות';
                            toggleBtn.querySelector('.fas:first-child').className = 'fas fa-minus';
                            toggleArrow.style.transform = 'rotate(180deg)';
                        }
                    });
                }

                // טיפול ב-popup הגדרות API
                const apiSettingsBtn = document.getElementById('api-settings-btn');
                const apiSettingsPopup = document.getElementById('api-settings-popup');
                const closeSettingsBtn = document.getElementById('close-settings-popup');

                if (apiSettingsBtn && apiSettingsPopup && closeSettingsBtn) {
                    apiSettingsBtn.addEventListener('click', function () {
                        apiSettingsPopup.style.display = 'flex';
                    });

                    closeSettingsBtn.addEventListener('click', function () {
                        apiSettingsPopup.style.display = 'none';
                    });

                    // סגירה בלחיצה מחוץ לpopup
                    apiSettingsPopup.addEventListener('click', function (e) {
                        if (e.target === apiSettingsPopup) {
                            apiSettingsPopup.style.display = 'none';
                        }
                    });
                }

                // טיפול בpopup של תמלולים אחרונים
                const viewRecentBtn = document.getElementById('view-recent-transcriptions-btn');
                const recentPopup = document.getElementById('recent-transcriptions-popup');
                const closeRecentBtn = document.getElementById('close-transcriptions-popup');

                if (viewRecentBtn && recentPopup && closeRecentBtn) {
                    viewRecentBtn.addEventListener('click', function () {
                        recentPopup.style.display = 'flex';
                    });

                    closeRecentBtn.addEventListener('click', function () {
                        recentPopup.style.display = 'none';
                    });

                    recentPopup.addEventListener('click', function (e) {
                        if (e.target === recentPopup) {
                            recentPopup.style.display = 'none';
                        }
                    });
                }

                // טיפול בhelpPopup
                const helpBtn = document.getElementById('help-btn');
                const helpPopup = document.getElementById('help-popup');
                const closeBtn = document.getElementById('close-help-popup');
                const scrollToApiBtn = document.getElementById('scroll-to-api');

                function toggleHelpPopup() {
                    helpPopup.classList.toggle('show');
                }

                function scrollToApiSettings() {
                    const apiSettingsBtn = document.getElementById('api-settings-btn');
                    if (apiSettingsBtn) {
                        apiSettingsBtn.click();
                        toggleHelpPopup();
                    }
                }

                if (helpBtn) helpBtn.addEventListener('click', toggleHelpPopup);
                if (closeBtn) closeBtn.addEventListener('click', toggleHelpPopup);
                if (scrollToApiBtn) scrollToApiBtn.addEventListener('click', scrollToApiSettings);

                document.addEventListener('click', function (event) {
                    if (helpPopup && helpPopup.classList.contains('show') &&
                        !helpPopup.contains(event.target) &&
                        event.target !== helpBtn) {
                        toggleHelpPopup();
                    }
                });
            });

            // פונקציה לטעינת תמלולים אחרונים


            function getSourceIcon(source) {
                const icons = {
                    upload: 'file-audio',
                    recording: 'microphone',
                    youtube: 'video'
                };
                return icons[source] || 'file-audio';
            }

            function formatTime(date) {
                const now = new Date();
                const diff = now - date;
                const minutes = Math.floor(diff / 60000);
                const hours = Math.floor(minutes / 60);
                const days = Math.floor(hours / 24);

                if (minutes < 1) return 'עכשיו';
                if (minutes < 60) return `לפני ${minutes} דקות`;
                if (hours < 24) return `לפני ${hours} שעות`;
                if (days < 7) return `לפני ${days} ימים`;

                return date.toLocaleDateString('he-IL', {
                    day: 'numeric',
                    month: 'short',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }

            // פונקציות לטיפול בפעולות על תמלולים
            function viewTranscription(id) {
                if (window.ui && window.ui.transcriptionHistory) {
                    const item = window.ui.transcriptionHistory.getItem(id);
                    if (item) {
                        document.getElementById('recent-transcriptions-popup').style.display = 'none';
                        window.ui.restoreFromHistoryWithTabs(item);
                    }
                }
            }

            function copyTranscription(id) {
                if (window.ui && window.ui.transcriptionHistory) {
                    const item = window.ui.transcriptionHistory.getItem(id);
                    if (item && item.transcription) {
                        navigator.clipboard.writeText(item.transcription).then(() => {
                            showTempMessage('התמלול הועתק ללוח', 'success');
                        });
                    }
                }
            }

            function toggleDownloadMenu(id) {
                const menu = document.getElementById(`download-menu-${id}`);
                if (menu) {
                    const isVisible = menu.style.display !== 'none';

                    // סגירת כל התפריטים האחרים
                    document.querySelectorAll('.download-menu').forEach(m => {
                        if (m !== menu) m.style.display = 'none';
                    });

                    menu.style.display = isVisible ? 'none' : 'block';
                }
            }

            function downloadTranscriptionFormat(id, format) {
                if (window.ui && window.ui.transcriptionHistory) {
                    const item = window.ui.transcriptionHistory.getItem(id);
                    if (item && item.transcription) {
                        let blob, fileName;
                        const baseName = item.fileName.replace(/\.[^/.]+$/, '');

                        switch (format) {
                            case 'txt':
                                // BOM כפול
                                blob = new Blob(['\ufeff\ufeff' + item.transcription], { type: 'text/plain;charset=utf-8' });
                                fileName = `${baseName}_תמלול.txt`;
                                break;

                            case 'word':
                                const wordContent = createWordDocument(item.transcription, item.fileName);
                                // RTF במקום HTML
                                blob = new Blob([wordContent], { type: 'application/rtf;charset=utf-8' });
                                fileName = `${baseName}_תמלול.rtf`;
                                break;

                            case 'srt':
                                const srtContent = createSRTContent(item.transcription);
                                blob = new Blob(['\ufeff\ufeff' + srtContent], { type: 'text/plain;charset=utf-8' });
                                fileName = `${baseName}_תמלול.srt`;
                                break;

                            case 'pdf':
                                // פתרון print-to-PDF
                                createPrintablePDFFromHistory(item);
                                return;

                            case 'mp3':
                            case 'wav':
                                if (item.audioBlob) {
                                    blob = item.audioBlob;
                                    fileName = `${baseName}.${format}`;
                                } else {
                                    showTempMessage('קובץ האודיו המקורי לא זמין', 'error');
                                    return;
                                }
                                break;

                            default:
                                return;
                        }

                        const link = document.createElement('a');
                        link.href = URL.createObjectURL(blob);
                        link.download = fileName;
                        document.body.appendChild(link);
                        link.click();
                        setTimeout(() => {
                            document.body.removeChild(link);
                            URL.revokeObjectURL(link.href);
                        }, 100);

                        showTempMessage(`הקובץ ${fileName} הורד בהצלחה`, 'success');
                    }
                }

                document.getElementById(`download-menu-${id}`).style.display = 'none';
            }

            // פונקציה נוספת ל-PDF מהיסטוריה
            function createPrintablePDFFromHistory(item) {
                const printHTML = `<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <title>תמלול - ${item.fileName}</title>
    <style>
        @page { size: A4; margin: 2cm; }
        body { font-family: Arial, serif; font-size: 14pt; direction: rtl; margin: 20px; }
        .header { text-align: center; border-bottom: 2px solid #333; padding-bottom: 10px; margin-bottom: 20px; }
        .content { white-space: pre-wrap; text-align: justify; }
    </style>
</head>
<body>
    <div class="header"><h1>תמלול - ${item.fileName}</h1></div>
    <div class="content">${item.transcription.replace(/[&<>"']/g, m => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' })[m])}</div>
</body>
</html>`;

                const printWindow = window.open('', '_blank');
                printWindow.document.write(printHTML);
                printWindow.document.close();
                setTimeout(() => printWindow.focus(), 500);
            }

            function createWordDocument(text, fileName) {
                return `<!DOCTYPE html>
                <html dir="rtl" lang="he">
                <head>
                    <meta charset="UTF-8">
                    <meta name="ProgId" content="Word.Document">
                    <meta name="Generator" content="Microsoft Word">
                    <meta name="Originator" content="Microsoft Word">
                    <title>תמלול - ${fileName}</title>
                    <style>
                        @page {
                            margin: 2.5cm;
                            mso-page-orientation: portrait;
                        }
                        body {
                            font-family: 'David', 'Times New Roman', serif;
                            font-size: 12pt;
                            line-height: 1.6;
                            direction: rtl;
                            text-align: right;
                            margin: 0;
                            padding: 20px;
                        }
                        h1 {
                            color: #2c3e50;
                            border-bottom: 2px solid #3498db;
                            padding-bottom: 10px;
                            margin-bottom: 20px;
                            font-size: 18pt;
                            text-align: center;
                        }
                        p {
                            margin-bottom: 12pt;
                            text-align: justify;
                            text-indent: 1cm;
                        }
                        .content {
                            white-space: pre-wrap;
                            word-wrap: break-word;
                        }
                    </style>
                </head>
                <body>
                    <h1>תמלול - ${fileName}</h1>
                    <div class="content">${text.split('\n').map(line =>
                    line.trim() ? `<p>${line.trim()}</p>` : '<p>&nbsp;</p>'
                ).join('')}</div>
                </body>
                </html>`;
            }

            function createSRTContent(text) {
                const lines = text.split('\n').filter(line => line.trim());
                let srtContent = '';

                lines.forEach((line, index) => {
                    if (line.trim()) {
                        const startTime = index * 3; // 3 שניות לכל שורה
                        const endTime = (index + 1) * 3;

                        srtContent += `${index + 1}\n`;
                        srtContent += `${formatSRTTime(startTime)} --> ${formatSRTTime(endTime)}\n`;
                        srtContent += `${line}\n\n`;
                    }
                });

                return srtContent;
            }

            function formatSRTTime(seconds) {
                const date = new Date(0);
                date.setSeconds(seconds);

                const hours = date.getUTCHours().toString().padStart(2, '0');
                const minutes = date.getUTCMinutes().toString().padStart(2, '0');
                const secs = date.getUTCSeconds().toString().padStart(2, '0');

                return `${hours}:${minutes}:${secs},000`;
            }

            function deleteTranscription(id) {
                if (confirm('האם אתה בטוח שברצונך למחוק את התמלול הזה?')) {
                    if (window.ui && window.ui.transcriptionHistory) {
                        window.ui.transcriptionHistory.deleteItem(id);
                        loadRecentTranscriptions();
                        updateRecentCountBadge();
                        showTempMessage('התמלול נמחק', 'success');
                    }
                }
            }

            function showTempMessage(message, type = 'info') {
                const messageEl = document.createElement('div');
                messageEl.className = `temp-message temp-message-${type}`;
                messageEl.textContent = message;
                messageEl.style.cssText = `
                    position: fixed;
                    top: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : '#007bff'};
                    color: white;
                    padding: 12px 20px;
                    border-radius: 8px;
                    font-weight: 500;
                    z-index: 2000;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
                    animation: slideDown 0.3s ease-out;
                `;

                document.body.appendChild(messageEl);

                setTimeout(() => {
                    messageEl.style.animation = 'fadeOut 0.3s ease-out forwards';
                    setTimeout(() => {
                        if (messageEl.parentNode) {
                            document.body.removeChild(messageEl);
                        }
                    }, 300);
                }, 3000);
            }

            function updateRecentCountBadge() {
                if (window.ui && window.ui.transcriptionHistory) {
                    const count = window.ui.transcriptionHistory.history.length;
                    const badge = document.getElementById('recent-count');
                    const btn = document.getElementById('view-recent-transcriptions-btn');

                    if (count > 0) {
                        if (badge) {
                            badge.textContent = count;
                            badge.style.display = 'inline-block';
                        }
                        if (btn) {
                            btn.style.display = 'flex';
                        }
                    } else {
                        if (badge) {
                            badge.style.display = 'none';
                        }
                        if (btn) {
                            btn.style.display = 'none';
                        }
                    }
                }
            }

            // סגירת תפריטי הורדה בלחיצה מחוץ
            document.addEventListener('click', function (e) {
                if (!e.target.closest('.download-dropdown')) {
                    document.querySelectorAll('.download-menu').forEach(menu => {
                        menu.style.display = 'none';
                    });
                }
            });
        </script>

        <!-- סקריפטים לטיפול במודלי הדרכה -->
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                // מודאל OpenAI
                const openaiHelpIcon = document.getElementById("openai-help-icon");
                const openaiModal = document.getElementById("openai-guide-modal");
                const openaiCloseModal = document.querySelector("#openai-guide-modal .close-modal");

                if (openaiHelpIcon && openaiModal && openaiCloseModal) {
                    openaiHelpIcon.addEventListener("click", () => {
                        openaiModal.style.display = "block";
                    });

                    openaiCloseModal.addEventListener("click", () => {
                        openaiModal.style.display = "none";
                    });

                    window.addEventListener("click", (e) => {
                        if (e.target === openaiModal) {
                            openaiModal.style.display = "none";
                        }
                    });
                }

                // מודאל Hugging Face
                const huggingfaceHelpIcon = document.getElementById("huggingface-help-icon");
                const huggingfaceModal = document.getElementById("huggingface-guide-modal");
                const huggingfaceCloseModal = document.querySelector("#huggingface-guide-modal .close-modal");

                if (huggingfaceHelpIcon && huggingfaceModal && huggingfaceCloseModal) {
                    huggingfaceHelpIcon.addEventListener("click", () => {
                        huggingfaceModal.style.display = "block";
                    });

                    huggingfaceCloseModal.addEventListener("click", () => {
                        huggingfaceModal.style.display = "none";
                    });

                    window.addEventListener("click", (e) => {
                        if (e.target === huggingfaceModal) {
                            huggingfaceModal.style.display = "none";
                        }
                    });
                }

                // מודאל Groq
                const groqHelpIcon = document.getElementById("groq-help-icon");
                const groqModal = document.getElementById("groq-guide-modal");
                const groqCloseModal = document.querySelector("#groq-guide-modal .close-modal");

                if (groqHelpIcon && groqModal && groqCloseModal) {
                    groqHelpIcon.addEventListener("click", () => {
                        groqModal.style.display = "block";
                    });

                    groqCloseModal.addEventListener("click", () => {
                        groqModal.style.display = "none";
                    });

                    window.addEventListener("click", (e) => {
                        if (e.target === groqModal) {
                            groqModal.style.display = "none";
                        }
                    });
                }

                // מודאל Gemini
                const geminiHelpIcon = document.getElementById("gemini-help-icon");
                const geminiModal = document.getElementById("gemini-guide-modal");
                const geminiCloseModal = document.querySelector("#gemini-guide-modal .close-modal");

                if (geminiHelpIcon && geminiModal && geminiCloseModal) {
                    geminiHelpIcon.addEventListener("click", () => {
                        geminiModal.style.display = "block";
                    });

                    geminiCloseModal.addEventListener("click", () => {
                        geminiModal.style.display = "none";
                    });

                    window.addEventListener("click", (e) => {
                        if (e.target === geminiModal) {
                            geminiModal.style.display = "none";
                        }
                    });
                }

                // מודאל Anthropic
                const anthropicHelpIcon = document.getElementById("anthropic-help-icon");
                const anthropicModal = document.getElementById("anthropic-guide-modal");
                const anthropicCloseModal = document.querySelector("#anthropic-guide-modal .close-modal");

                if (anthropicHelpIcon && anthropicModal && anthropicCloseModal) {
                    anthropicHelpIcon.addEventListener("click", () => {
                        anthropicModal.style.display = "block";
                    });

                    anthropicCloseModal.addEventListener("click", () => {
                        anthropicModal.style.display = "none";
                    });

                    window.addEventListener("click", (e) => {
                        if (e.target === anthropicModal) {
                            anthropicModal.style.display = "none";
                        }
                    });
                }
            });
        </script>

        <!-- סקריפט לטיפול בתצוגה דינמית של API keys -->
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                // פונקציה להצגת/הסתרת שדה API key
                function toggleApiInput(selectElement, inputContainer, labelElement, inputElement, provider) {
                    const savedKey = localStorage.getItem(`${provider}_api_key`);

                    if (!savedKey) {
                        inputContainer.style.display = 'block';
                        labelElement.textContent = `מפתח API של ${getProviderName(provider)}:`;
                        inputElement.placeholder = `הזן מפתח API של ${getProviderName(provider)}`;
                    } else {
                        inputContainer.style.display = 'none';
                        updateApiStatus(inputContainer.querySelector('.api-status-mini'), true, provider);
                    }
                }

                // פונקציה לקבלת שם הספק בעברית
                function getProviderName(provider) {
                    const names = {
                        openai: 'OpenAI',
                        groq: 'Groq',
                        anthropic: 'Anthropic Claude',
                        gemini: 'Google Gemini'
                    };
                    return names[provider] || provider;
                }

                // פונקציה לעדכון סטטוס API
                function updateApiStatus(statusElement, isSuccess, provider) {
                    if (!statusElement) return;

                    statusElement.className = `api-status-mini ${isSuccess ? 'success' : 'error'}`;
                    statusElement.textContent = isSuccess
                        ? `מפתח ${getProviderName(provider)} פעיל ✓`
                        : `נדרש מפתח ${getProviderName(provider)}`;
                }

                // טיפול בבחירת ספק להגהה
                const enhanceSelect = document.getElementById('enhance-provider-select');
                const enhanceApiInput = document.getElementById('enhance-api-input');
                const enhanceApiLabel = document.getElementById('enhance-api-label');
                const enhanceApiKey = document.getElementById('enhance-api-key');
                const saveEnhanceApi = document.getElementById('save-enhance-api');
                const enhanceApiStatus = document.getElementById('enhance-api-status');

                if (enhanceSelect && enhanceApiInput) {
                    enhanceSelect.addEventListener('change', function () {
                        toggleApiInput(this, enhanceApiInput, enhanceApiLabel, enhanceApiKey, this.value);
                    });

                    toggleApiInput(enhanceSelect, enhanceApiInput, enhanceApiLabel, enhanceApiKey, enhanceSelect.value);
                }

                if (saveEnhanceApi) {
                    saveEnhanceApi.addEventListener('click', function () {
                        const provider = enhanceSelect.value;
                        const apiKey = enhanceApiKey.value.trim();

                        if (apiKey) {
                            localStorage.setItem(`${provider}_api_key`, apiKey);
                            updateApiStatus(enhanceApiStatus, true, provider);
                            enhanceApiInput.style.display = 'none';

                            const btn = this;
                            const originalText = btn.innerHTML;
                            btn.innerHTML = '<i class="fas fa-check"></i> נשמר!';
                            btn.style.background = '#007bff';

                            setTimeout(() => {
                                btn.innerHTML = originalText;
                                btn.style.background = '';
                            }, 2000);
                        } else {
                            updateApiStatus(enhanceApiStatus, false, provider);
                        }
                    });
                }

                // טיפול בבחירת ספק לסיכום
                const summarySelect = document.getElementById('summary-provider-select');
                const summaryApiInput = document.getElementById('summary-api-input');
                const summaryApiLabel = document.getElementById('summary-api-label');
                const summaryApiKey = document.getElementById('summary-api-key');
                const saveSummaryApi = document.getElementById('save-summary-api');
                const summaryApiStatus = document.getElementById('summary-api-status');

                if (summarySelect && summaryApiInput) {
                    summarySelect.addEventListener('change', function () {
                        toggleApiInput(this, summaryApiInput, summaryApiLabel, summaryApiKey, this.value);
                    });

                    toggleApiInput(summarySelect, summaryApiInput, summaryApiLabel, summaryApiKey, summarySelect.value);
                }

                if (saveSummaryApi) {
                    saveSummaryApi.addEventListener('click', function () {
                        const provider = summarySelect.value;
                        const apiKey = summaryApiKey.value.trim();

                        if (apiKey) {
                            localStorage.setItem(`${provider}_api_key`, apiKey);
                            updateApiStatus(summaryApiStatus, true, provider);
                            summaryApiInput.style.display = 'none';

                            const btn = this;
                            const originalText = btn.innerHTML;
                            btn.innerHTML = '<i class="fas fa-check"></i> נשמר!';
                            btn.style.background = '#007bff';

                            setTimeout(() => {
                                btn.innerHTML = originalText;
                                btn.style.background = '';
                            }, 2000);
                        } else {
                            updateApiStatus(summaryApiStatus, false, provider);
                        }
                    });
                }

                if (enhanceApiKey) {
                    enhanceApiKey.addEventListener('keypress', function (e) {
                        if (e.key === 'Enter') {
                            saveEnhanceApi.click();
                        }
                    });
                }

                if (summaryApiKey) {
                    summaryApiKey.addEventListener('keypress', function (e) {
                        if (e.key === 'Enter') {
                            saveSummaryApi.click();
                        }
                    });
                }
            });
        </script>

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                // הצגת/הסתרת מפתחות API
                const toggleKeys = [
                    { checkbox: 'show-openai-key', input: 'openai-api-key' },
                    { checkbox: 'show-huggingface-key', input: 'huggingface-api-key' },
                    { checkbox: 'show-groq-key', input: 'groq-api-key' },
                    { checkbox: 'show-gemini-key', input: 'gemini-api-key' },
                    { checkbox: 'show-anthropic-key', input: 'anthropic-api-key' }
                ];

                toggleKeys.forEach(({ checkbox, input }) => {
                    const checkboxElement = document.getElementById(checkbox);
                    const inputElement = document.getElementById(input);

                    if (checkboxElement && inputElement) {
                        checkboxElement.addEventListener("change", function () {
                            inputElement.type = this.checked ? "text" : "password";
                        });
                    }
                });
            });
        </script>
    </div>

</body>

</html>